{% extends "layouts/base.njk" %}

{% block content %}
<section class="product-page">
  <div class="container">

    {# ===============================
       PRODUCT GALLERY (AUTHORITATIVE)
       =============================== #}
    {% if page.data.gallery and page.data.gallery.length %}
      <section class="product-gallery-section">
        <div class="product-gallery-grid">
          {% for image in page.data.gallery %}
            <div class="product-gallery-item">
              <img
                src="{{ image }}"
                alt="{{ page.data.title }} image {{ loop.index }}"
                loading="lazy"
              >
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <div class="prose max-w-none product-content">
      {{ content | safe }}
    </div>

    <!-- âœ… ADD TO CART CTA BUTTON (ROUTES TO BUILDER) -->
   {% set sku = page.data.sku or page.fileSlug %}
   {% set urlPath = page.url or "" %}

   {# Detect builder type by URL path (Nunjucks-safe) #}
   {% set isRing = "/rings/" in urlPath %}

   {% if isRing %}
     {% set builderPath = "/builder/ring/" %}
   {% else %}
     {% set builderPath = "/builder/charm/" %}
   {% endif %}

   <div class="product-add-to-cart-wrap">
     <a
       href="{{ builderPath }}?sku={{ sku | urlencode }}"
       class="product-add-to-cart-link"
       aria-label="Customize and checkout"
     >
       <img
         src="/static/img/ui/add-to-cart.png"
         alt="Customize"
         class="product-add-to-cart-btn"
         loading="lazy"
       >
     </a>
   </div>
