<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Customize My Ring</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:20px;max-width:900px}
h1{margin:0 0 8px}
.summary{background:#101010;color:#fff;padding:12px 16px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
.panel{border:1px solid #ddd;border-radius:8px;padding:14px;margin:14px 0}
.row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
label{display:block;margin:8px 0 4px}
input[type=number]{width:100%}
.breakdown{background:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #eee;padding:8px;text-align:left}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.btn{padding:10px 14px;border-radius:6px;border:none;cursor:pointer}
.btn.primary{background:#111;color:#fff}
.btn.secondary{background:#777;color:#fff}
a{color:#111}
@media(max-width:820px){.row{grid-template-columns:1fr}}
</style>
</head>
<body>
<h1>Customize My Ring</h1>
<div class="summary"><div><b id="prodName">Ring</b> • <span id="bandSummary">—</span></div><div>Total: $<span id="total">0</span></div></div>

<div class="panel">
  <div class="row">
    <div>
      <label>Band Height</label>
      <select id="bandHeight">
        <option value="small" data-price="30">3–6mm — $30</option>
        <option value="medium" data-price="60">6–9mm — $60</option>
        <option value="large" data-price="90">10–13mm — $90</option>
      </select>
    </div>
    <div>
      <label>Band Style</label>
      <select id="bandStyle">
        <option value="flat">Flat</option>
        <option value="domed">Domed</option>
        <option value="apex">Apex</option>
      </select>
    </div>
  </div>
</div>

<div class="panel">
  <h3>Text & Symbols</h3>
  <div class="row">
    <div>
      <label>Inside Engraving (words/symbols)</label>
      <input type="number" id="engraveInside" min="0" value="0">
    </div>
    <div>
      <label>Outside Engraving (words/symbols)</label>
      <input type="number" id="engraveOutside" min="0" value="0">
    </div>
  </div>
  <small>$4 per word/symbol • choose Engraved or Embossed during proofing</small>
</div>

<div class="panel">
  <h3>Decorative Options</h3>
  <div class="row">
    <div><label><input type="checkbox" id="beading" data-price="30"> Beading (+$30)</label></div>
    <div><label><input type="checkbox" id="rope" data-price="5"> Rope braid (+$5)</label></div>
    <div><label><input type="checkbox" id="cubanSmall" data-price="5"> Cuban link small 2mm (+$5)</label></div>
    <div><label><input type="checkbox" id="cubanLarge" data-price="30"> Cuban link large 7mm (+$30)</label></div>
    <div><label><input type="checkbox" id="channel" data-price="4"> Channel (+$4)</label> <small>Required for Cuban links</small></div>
    <div><label><input type="checkbox" id="cutout" data-price="4"> Cut‑out symbol (+$4)</label></div>
  </div>
</div>

<div class="panel">
  <h3>Patterns & Modifications</h3>
  <div class="row">
    <div><label><input type="checkbox" id="pattern" data-price="45"> Engraved pattern (+$45)</label></div>
    <div><label><input type="checkbox" id="mod" data-price="3"> Cut / modification (+$3)</label></div>
  </div>
</div>

<div class="breakdown">
  <table class="table" id="lines"><thead><tr><th>Item</th><th>Amt</th></tr></thead><tbody></tbody><tfoot><tr><th>Total</th><th id="linesTotal">$0</th></tr></tfoot></table>
</div>

<div class="actions">
  <button class="btn primary" id="resetBtn">Reset to Defaults</button>
  <a class="btn secondary" href="collections/rings/cuban/index.html">Back to Shop All Rings</a>
  <button class="btn" id="saveBtn">Save My Customization</button>
</div>

<script>
const q = new URLSearchParams(location.search);
const defaults = {
  product: q.get('product') || 'Ring',
  band_height: q.get('band_height') || 'medium',
  band_style: q.get('band_style') || 'flat',
  beading: q.get('beading') === '1',
  rope: q.get('rope') === '1',
  cubanSmall: q.get('cuban_small') === '1',
  cubanLarge: q.get('cuban_large') === '1',
  channel: q.get('channel') === '1',
  cutout: q.get('cutout') === '1',
  engraveInside: parseInt(q.get('engrave_inside')||'0',10),
  engraveOutside: parseInt(q.get('engrave_outside')||'0',10)
};

const prodName = document.getElementById('prodName');
const bandHeight = document.getElementById('bandHeight');
const bandStyle = document.getElementById('bandStyle');
const beading = document.getElementById('beading');
const rope = document.getElementById('rope');
const cubanSmall = document.getElementById('cubanSmall');
const cubanLarge = document.getElementById('cubanLarge');
const channel = document.getElementById('channel');
const cutout = document.getElementById('cutout');
const engraveInside = document.getElementById('engraveInside');
const engraveOutside = document.getElementById('engraveOutside');
const totalEl = document.getElementById('total');
const bandSummary = document.getElementById('bandSummary');
const linesBody = document.querySelector('#lines tbody');
const linesTotal = document.getElementById('linesTotal');
const resetBtn = document.getElementById('resetBtn');
const saveBtn = document.getElementById('saveBtn');
const pattern = document.getElementById('pattern');
const mod = document.getElementById('mod');

function applyDefaults() {
  prodName.textContent = defaults.product;
  bandHeight.value = defaults.band_height;
  bandStyle.value = defaults.band_style;
  beading.checked = defaults.beading;
  rope.checked = defaults.rope;
  cubanSmall.checked = defaults.cubanSmall;
  cubanLarge.checked = defaults.cubanLarge;
  channel.checked = defaults.channel;
  cutout.checked = defaults.cutout;
  engraveInside.value = defaults.engraveInside;
  engraveOutside.value = defaults.engraveOutside;
  recalc();
}

function addLine(name, amt){
  const tr = document.createElement('tr');
  const td1 = document.createElement('td'); const td2 = document.createElement('td');
  td1.textContent = name; td2.textContent = '$'+amt;
  tr.appendChild(td1); tr.appendChild(td2);
  linesBody.appendChild(tr);
  return amt;
}

function recalc(){
  linesBody.innerHTML='';
  let total = 0;

  const bhOpt = bandHeight.options[bandHeight.selectedIndex];
  const bhPrice = parseInt(bhOpt.dataset.price,10);
  const bhText = bhOpt.textContent;
  total += addLine('Band Height: '+bhText, bhPrice);

  const styleText = bandStyle.options[bandStyle.selectedIndex].textContent;
  addLine('Band Style: '+styleText, 0);

  const engrIn = parseInt(engraveInside.value||'0',10);
  const engrOut = parseInt(engraveOutside.value||'0',10);
  if(engrIn>0){ total += addLine('Inside engraving x'+engrIn+' @ $4', 4*engrIn); }
  if(engrOut>0){ total += addLine('Outside engraving x'+engrOut+' @ $4', 4*engrOut); }

  [beading, rope, cutout, channel, cubanSmall, cubanLarge, pattern, mod].forEach(cb=>{
    if(!cb) return;
    if(cb.checked){
      const amt = parseInt(cb.dataset.price||'0',10);
      total += addLine(cb.parentElement.textContent.trim(), amt);
    }
  });

  if((cubanSmall.checked || cubanLarge.checked) && !channel.checked){
    addLine('Note: Channel required for Cuban links (add +$4)', 0);
  }

  totalEl.textContent = total;
  linesTotal.textContent = '$'+total;
  bandSummary.textContent = bhText.split('—')[0].trim()+' • '+styleText;
}

['change','input'].forEach(evt=>{
  document.body.addEventListener(evt, e=>{ if(e.target.matches('input,select')) recalc(); });
});

resetBtn.addEventListener('click', e=>{ e.preventDefault(); applyDefaults(); });

saveBtn.addEventListener('click', e=>{
  e.preventDefault();
  const data = {
    product: prodName.textContent,
    band_height: bandHeight.value,
    band_style: bandStyle.value,
    beading: beading.checked,
    rope: rope.checked,
    cuban_small: cubanSmall.checked,
    cuban_large: cubanLarge.checked,
    channel: channel.checked,
    cutout: cutout.checked,
    engrave_inside: parseInt(engraveInside.value||'0',10),
    engrave_outside: parseInt(engraveOutside.value||'0',10),
    total: totalEl.textContent
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = (data.product.replace(/\s+/g,'_')||'ring') + '_customization.json';
  a.click();
});

applyDefaults();
</script>
</body></html>